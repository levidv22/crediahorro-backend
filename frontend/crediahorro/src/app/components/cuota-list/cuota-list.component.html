<main class="container mt-4">
  <div class="card shadow-lg border-0 rounded-4 bg-light">
    <div class="card-header bg-gradient text-white d-flex justify-content-between align-items-center rounded-top-4"
         style="background: linear-gradient(to right, #4e73df, #1cc88a);">
      <h4 class="m-0" style="color: black;">
        <i class="bi bi-calendar-check-fill"></i> Cuotas
      </h4>
      <button class="btn btn-light btn-sm" (click)="volver()">
        <i class="bi bi-arrow-left-circle"></i> Volver a Clientes
      </button>
      <button *ngIf="mostrarBotonPagarAdelanto" class="btn btn-outline-primary" (click)="irPagoAdelantado()">
        <i class="bi bi-forward-fill"></i> Pagar Adelanto
      </button>
    </div>

    <div class="card-body">
      <!-- Contenedor padre que coloca las alertas a izquierda y derecha -->
      <div class="d-flex justify-content-between mb-3">
        <!-- Alerta a la izquierda -->
        <div
          *ngIf="mensajeVencimiento"
          class="alert d-flex align-items-center gap-2 mb-0"
          [ngClass]="mensajeVencimiento.includes('cuota pagada') ? 'alert-info' : 'alert-danger'"
        >
          {{ mensajeVencimiento }}
        </div>

        <!-- Alerta a la derecha -->
        <div>
          <div *ngIf="cuotasPendientes > 0" class="alert alert-warning d-flex align-items-center gap-2 mb-0">

            Hay <strong>{{ cuotasPendientes }}</strong> cuota{{ cuotasPendientes === 1 ? '' : 's' }} pendiente{{ cuotasPendientes === 1 ? '' : 's' }} por pagar.
          </div>
          <div *ngIf="cuotasPendientes === 0" class="alert alert-success d-flex align-items-center gap-2 mb-0">

            ¡Genial! Ya se completó el pago de todas sus cuotas.
          </div>
        </div>
      </div>

      <!-- Tabla de cuotas -->
      <div class="table-responsive rounded-3">
        <table class="table table-hover align-middle text-center">
          <thead class="table-dark">
          <tr>
            <th><i class="bi bi-calendar-event"></i> Fecha de Pago</th>
            <th><i class="bi bi-calendar-event"></i> Fecha Pagada</th>
            <th>S/ Monto Cuota</th>
            <th><i class="bi bi-clipboard-check"></i> Estado</th>
            <th>----------</th>
            <th>----------</th>
            <th>----------</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let cuota of cuotas; let i = index">
            <td>{{ cuota.fechaPago | date: 'dd/MM/yyyy' }}</td>
            <td>{{ cuota.fechaPagada ? (cuota.fechaPagada | date: 'dd/MM/yyyy') : '- -/- -/- - - -' }}</td>
            <td>{{ cuota.montoCuota | currency: 'S/':'symbol':'1.2-2' }}</td>
            <td>
              <ng-container *ngIf="cuota.tipoPago === 'NO_PAGADA'; else estadoNormal">
                <span class="badge rounded-pill bg-danger px-3 py-2">No Pagada</span>
              </ng-container>

              <ng-template #estadoNormal>
  <span *ngIf="cuota.tipoPago === 'PAGO_INCOMPLETO'" class="badge rounded-pill bg-info text-dark px-3 py-2">
    Pago Parcial
  </span>
                <span *ngIf="cuota.tipoPago === 'Adelanto_MIXTO'" class="badge rounded-pill bg-secondary text-white px-3 py-2">
    Interés + Capital Incompleto
  </span>
                <span *ngIf="cuota.estado === 'PAGADA' && cuota.tipoPago !== 'PAGO_INCOMPLETO' && cuota.tipoPago !== 'Adelanto_MIXTO'" class="badge rounded-pill bg-success px-3 py-2">
    Pagada
  </span>
                <span *ngIf="cuota.estado === 'PENDIENTE'" class="badge rounded-pill bg-warning text-dark px-3 py-2">
    Pendiente
  </span>
                <span *ngIf="cuota.estado === 'ADELANTADO'" class="badge rounded-pill bg-primary px-3 py-2">
    Adelantado
  </span>
              </ng-template>
            </td>
            <td>
              <button
                class="btn btn-success btn-sm me-1"
                [disabled]="!esPagarHabilitado(i)"
                *ngIf="cuota.estado === 'PENDIENTE'"
                (click)="pagarCuota(cuota.id)">
                <i class="bi bi-check"></i> Pagar
              </button>
            </td>
            <td>
              <button
                class="btn btn-danger btn-sm me-1"
                [disabled]="!esOtroHabilitado(i)"
                *ngIf="cuota.estado === 'PENDIENTE'"
                (click)="noPagarCuota(cuota.id)">
                <i class="bi bi-x"></i> No Pagar
              </button>
            </td>
            <td>
              <button
                class="btn btn-info btn-sm me-1"
                [disabled]="!esOtroHabilitado(i)"
                *ngIf="cuota.estado === 'PENDIENTE'"
                (click)="abrirModalPagoParcial(cuota.id)">
                <i class="bi bi-cash"></i> Ingresar Monto
              </button>
            </td>
          </tr>
          </tbody>
        </table>
        <div class="row mt-4 g-3">
          <div class="col-md-4">
            <div class="card border-start border-4 border-primary shadow-sm h-100">
              <div class="card-body d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="card-title text-muted mb-1">Total a Pagar</h6>
                  <h5 class="text-primary fw-bold">{{ totalAPagar | currency: 'S/':'symbol':'1.2-2' }}</h5>
                </div>
                <i class="bi bi-wallet2 fs-2 text-primary"></i>
              </div>
            </div>
          </div>

          <div class="col-md-4">
            <div class="card border-start border-4 border-success shadow-sm h-100">
              <div class="card-body d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="card-title text-muted mb-1">Total Pagado</h6>
                  <h5 class="text-success fw-bold">{{ totalPagado | currency: 'S/':'symbol':'1.2-2' }}</h5>
                </div>
                <i class="bi bi-check2-circle fs-2 text-success"></i>
              </div>
            </div>
          </div>

          <div class="col-md-4">
            <div class="card border-start border-4 border-danger shadow-sm h-100">
              <div class="card-body d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="card-title text-muted mb-1">Falta Pagar</h6>
                  <h5 class="text-danger fw-bold">{{ faltaPagar | currency: 'S/':'symbol':'1.2-2' }}</h5>
                </div>
                <i class="bi bi-exclamation-circle fs-2 text-danger"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>
<!-- Modal para ingresar monto -->
<div class="modal fade" id="modalPagoParcial" tabindex="-1" aria-labelledby="modalPagoParcialLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content rounded-3 shadow">
      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title" id="modalPagoParcialLabel">
          <i class="bi bi-cash-coin"></i> Ingresar Monto Parcial
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <label for="inputMontoParcial" class="form-label">Monto a pagar</label>
        <input
          type="number"
          min="0.01"
          class="form-control"
          id="inputMontoParcial"
          [(ngModel)]="montoParcial"
          placeholder="Ingrese el monto a pagar">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-success" (click)="confirmarPagoParcial()">Confirmar</button>
      </div>
    </div>
  </div>
</div>


